---
title: "SWCãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ã¦JavaScriptãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã®ä»•çµ„ã¿ã«è§¦ã‚Œã‚‹"
emoji: "ğŸ“š"
type: "tech"
topics: ["swc", "rust", "JavaScript"]
published: false
publication_name: "sun_asterisk"
---

## ã¯ã˜ã‚ã«

### è‡ªå·±ç´¹ä»‹

Frontend Engineerã®ofujiã§ã™ã€‚
æ¥­å‹™ã§ã¯ãƒªãƒ¼ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦ã€é–‹ç™ºã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
æœ€è¿‘ã§ã¯ä¸»ã«Reactã¨TypeScriptã‚’ä½¿ã£ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã‚’è¡Œã†ã“ã¨ãŒå¤šã„ã§ã™ã€‚

å€‹äººã§ã¯ã€RustãŒå¥½ãã§ç°¡å˜ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ãªã‚Šã—ã¦æ¥½ã—ã‚“ã§ã„ã¾ã™ã€‚
å®Ÿã¯ä»Šå›ã®è¨˜äº‹ã‚‚ãã®ä¸€è²«ã«ãªã‚Šã¾ã™ã€‚

### ã“ã®è¨˜äº‹ã®ç›®çš„
ä»Šå›ã®è¨˜äº‹ã§ã¯ã€SWCã¨ã„ã†JavaScriptã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ã‚’ä½¿ã£ã¦ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€JavaScriptã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã®ä»•çµ„ã¿ã«è§¦ã‚Œã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

### ã“ã®è¨˜äº‹ã®æ§‹æˆ

ã“ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®å†…å®¹ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚

1. **ã¯ã˜ã‚ã«**
2. SWCã¨ã¯
3. JavaScriptã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã«ã¤ã„ã¦
4. ASTã«ã¤ã„ã¦
5. SWCã®ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¦ã¿ã‚‹
6. ã¾ã¨ã‚
7. å‚è€ƒæ–‡çŒ®

## SWCã¨ã¯

SWCã¨ã¯ã€Rustã§æ›¸ã‹ã‚ŒãŸJavaScript/TypeScriptã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ã§ã™ã€‚
åŒç­‰ã®æ©Ÿèƒ½ã‚’æŒã¤Babelã¨æ¯”è¼ƒã—ã¦ã€é«˜é€Ÿã§ã‚ã‚‹ã“ã¨ãŒç‰¹å¾´ã§ã™ã€‚
(ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ä¸Šã§Babelã®20å€æ—©ã„ã¨ã‹ãªã‚“ã¨ã‹)

https://swc.rs/

èº«è¿‘ãªã¨ã“ã‚ã§ã¯ã€Next.jsã§ã‚ˆãè©±é¡Œã«ãªã£ãŸã‚Šã—ã¾ã™ã‚ˆã­ã€‚
https://nextjs.org/docs/architecture/nextjs-compiler

ä¸»ã«æ©Ÿèƒ½ã¨ã—ã¦ã¯ã€Compilationã‚„Minificationã€Bundlingç­‰ãŒã‚ã‚Šã¾ã™ã€‚

## JavaScriptã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã«ã¤ã„ã¦

æ™®æ®µç§ãŸã¡ãŒåˆ©ç”¨ã—ã¦ã„ã‚‹TypeScriptã‚„JSXã¯JavaScriptã®ã‚¨ãƒ³ã‚¸ãƒ³ã§ãã®ã¾ã¾å®Ÿè¡Œã¯ã§ãã¾ã›ã‚“ã€‚
ãªã®ã§å®Ÿè¡Œã§ãã‚‹å½¢ã«ï¼ˆã¤ã¾ã‚ŠJavaScriptã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ï¼‰ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

:::message
ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«(ãƒˆãƒ©ãƒ³ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«)ã¨ã¯

ãƒ•ãƒªãƒ¼ç™¾ç§‘äº‹å…¸ã€ã‚¦ã‚£ã‚­ãƒšãƒ‡ã‚£ã‚¢ï¼ˆWikipediaï¼‰ã€https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9)
> ã‚ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§æ›¸ã‹ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã¨ã—ã¦å—ã‘å–ã‚Šã€åˆ¥ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®åŒç­‰ã®ã‚³ãƒ¼ãƒ‰ã‚’ç›®çš„ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ç”Ÿæˆã™ã‚‹ã€ã‚ã‚‹ç¨®ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã‚ã‚‹
:::

ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```mermaid
graph LR
    A[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰] --> B
    B[parser] --> C
    C[AST] --> D
    D[traverser] --> E
    E[AST] --> F
    F[generator] --> G
    G[JavaScript]
```
ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã®å‡¦ç†ã®ä¸­ã§ã¯AST(Abstract Syntax Tree)ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä¸­é–“è¡¨ç¾ã¨ã—ã¦åˆ©ç”¨ã—ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è§£æã—ã¦ã„ãã¾ã™ã€‚
â€»ASTã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ã€‚

### parser
å›³ã®ã”ã¨ãã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ASTã«å¤‰æ›ã™ã‚‹å‡¦ç†ã§ã™ã€‚
ã“ã“ã§ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’Nodeã¨å‘¼ã°ã‚Œã‚‹å˜ä½ã«åˆ†å‰²ã—ã€ãã‚Œãã‚Œæ„å‘³ã®ã‚ã‚‹å½¢ã¨ã—ã¦æ§‹é€ åŒ–ã—ã¦ã„ãã¾ã™ã€‚
ã“ã¡ã‚‰ã®ãƒ•ã‚§ãƒ¼ã‚ºã«ã¤ã„ã¦ã‚‚è©³ç´°ã«æ›¸ãã¨ã€ä¸‹å›³ã®ã‚ˆã†ãªãƒ•ãƒ­ãƒ¼ãŒã‚ã‚‹ã®ã§ã™ãŒè©³ã—ã„å†…å®¹ã¯å‰²æ„›ã—ã¾ã™ã€‚

```mermaid
graph LR
    A[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰] --> B
    B[Lexer] --> C
    C[Token] --> D
    D[Parser] --> E
    E[AST]
```

ã‚‚ã—ã”èˆˆå‘³ãŒã‚ã‚Œã°ã€ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚
https://oxc-project.github.io/javascript-parser-in-rust/docs/overview

### traverser
ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ç”Ÿæˆã•ã‚ŒãŸASTã«å¯¾ã—ã€å†å¸°çš„ã«è§£æã‚’è¡Œã„ã¾ã™ã€‚
ãã®éç¨‹ã§ã€ASTã®ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦å‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
swcã‚„babelã§ã¯ã€ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã§ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦å‡¦ç†ã‚’ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
å‰è¿°ã—ãŸJsxç­‰ã‚’JavaScriptã«å¤‰æ›ã™ã‚‹å‡¦ç†ã‚‚ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã§è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚

ä¾‹ï¼‰
React Jsxã‚’å¤‰æ›ã™ã‚‹pluginã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªç‰©ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://babeljs.io/docs/babel-plugin-transform-react-jsx

### generator
æœ€å¾Œã«ã€ASTã‚’JavaScriptã«å¤‰æ›ã™ã‚‹å‡¦ç†ã§ã™ã€‚
ã“ã®ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€ASTã‚’å†å¸°çš„ã«è§£æã—ã€JavaScriptã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚


## ASTã«ã¤ã„ã¦

Abstract Syntax Treeã®ç•¥ã§ã€æŠ½è±¡æ§‹æ–‡æœ¨ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™ã€‚
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ–‡æ³•ã‚’æŠ½è±¡çš„ã«è¡¨ç¾ã—ã€éšå±¤çš„ã«æ§‹é€ åŒ–ã—ãŸãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚
ASTã¯ã€Nodeã¨ã„ã†å˜ä½ã§æ§‹æˆã•ã‚Œã¦ã¾ã™ã€‚
ä¾‹ãˆã°ä»¥ä¸‹ã®ã‚ˆã†ãªã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚ã£ãŸå ´åˆã€ASTã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```JavaScript
function hoge () {
    const huga = 'huga';
    console.log(huga);
}
```

```AST
{
  "type": "Program",
  "start": 0,
  "end": 65,
  "body": [
    {
      "type": "FunctionDeclaration",
      "start": 0,
      "end": 65,
      "id": {
        "type": "Identifier",
        "start": 9,
        "end": 13,
        "name": "hoge"
      },
      "expression": false,
      "generator": false,
      "async": false,
      "params": [],
      "body": {
        "type": "BlockStatement",
        "start": 17,
        "end": 65,
        "body": [
          {
            "type": "VariableDeclaration",
            "start": 20,
            "end": 40,
            "declarations": [
              {
                "type": "VariableDeclarator",
                "start": 26,
                "end": 39,
                "id": {
                  "type": "Identifier",
                  "start": 26,
                  "end": 30,
                  "name": "huga"
                },
                "init": {
                  "type": "Literal",
                  "start": 33,
                  "end": 39,
                  "value": "huga",
                  "raw": "'huga'"
                }
              }
            ],
            "kind": "const"
          },
          {
            "type": "ExpressionStatement",
            "start": 45,
            "end": 63,
            "expression": {
              "type": "CallExpression",
              "start": 45,
              "end": 62,
              "callee": {
                "type": "MemberExpression",
                "start": 45,
                "end": 56,
                "object": {
                  "type": "Identifier",
                  "start": 45,
                  "end": 52,
                  "name": "console"
                },
                "property": {
                  "type": "Identifier",
                  "start": 53,
                  "end": 56,
                  "name": "log"
                },
                "computed": false,
                "optional": false
              },
              "arguments": [
                {
                  "type": "Identifier",
                  "start": 57,
                  "end": 61,
                  "name": "huga"
                }
              ],
              "optional": false
            }
          }
        ]
      }
    }
  ],
  "sourceType": "module"
}
```

è«¸ã€…èª¬æ˜ãŒå¿…è¦ã‹ã¨æ€ã„ã¾ã™ãŒã€
ã¾ãšåˆã‚ã«JavaScriptã§ã¯ESTreeã¨ã„ã†MozillaãŒç­–å®šã—ãŸASTã®ä»•æ§˜ãŒåŸºç¤ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://github.com/estree/estree

ç‰¹å¾´ã¨ã—ã¦ã¯ã€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®Nodeã§ã‚ã‚‹ProgramãŒsourceTypeã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒã£ã¦ãŠã‚Šã€ãã®å€¤ãŒmoduleã®å ´åˆã¯ES Moduleã€scriptã®å ´åˆã¯Scriptã¨ã„ã†ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚
ä¸Šè¨˜ä¾‹ã§ã¯ã€moduleã¨ãªã£ã¦ã„ã‚‹ã®ã§ES Moduleã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

:::message
JavaScript ASTã«ã¯Babel/Babylon(Acornç³»)ã‚„Esprimaç³»ç­‰è¤‡æ•°ã®ç¨®é¡ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã“ã¡ã‚‰ã«ã¤ã„ã¦ã¯å‰²æ„›ã—ã¾ã™ã€‚
:::

ä»Šå›ä½œæˆã™ã‚‹pluginã¯SWCã®pluginã§ã‚ã‚‹ã‚ã‘ã§ã™ãŒã€SWCã§æ¡ç”¨ã—ã¦ã„ã‚‹ASTã¯ç‹¬è‡ªã§å®šç¾©ã—ãŸã‚‚ã®ã‚’åˆ©ç”¨ã—ã¦ãŠã‚ŠESTreeã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚
ã‚‚ã—èˆˆå‘³ãŒã‚ã‚Œã°ã€ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã®ãƒšãƒ¼ã‚¸ã§è©¦ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

https://play.swc.rs/

ã•ã¦å°‘ã—è©±ãŒãã‚Œã¾ã—ãŸãŒã€ã¾ã èª¬æ˜ã§ãã¦ã„ãªã„NodeãŒã‚ã‚Šã¾ã™ã­ã€‚
ä¸Šè¿°ã—ãŸProgramä»–ã«ã‚‚Statementã‚„Expressionã€Declarationsã€Identifierã€Literalç­‰æ§˜ã€…ãªNodeãŒå­˜åœ¨ã—ã¾ã™ã€‚

å¤§ä½“ã“ã“ã«ã¾ã¨ã¾ã£ã¦ã„ã¾ã™ã®ã§ã€ã“ã¡ã‚‰ã‚‚èˆˆå‘³ãŒã‚ã‚Œã°è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚
https://github.com/estree/estree/blob/master/es5.md


### Statement
æ–‡ã‚’è¡¨ã™Nodeã§ã™ã€‚
BlockStatementã§ã‚ã‚Œã°ã€{}ã§å›²ã¾ã‚ŒãŸéƒ¨åˆ†ã‚’è¡¨ã—ã¾ã™ã€‚

### Expression
å¼ã‚’è¡¨ã™Nodeã§ã™ã€‚
ä¸Šè¨˜ä¾‹ã§ã¯ã€CallExpressionã‚„MemberExpressionãŒè©²å½“ã—ã¾ã™ã€‚

### Declarations
å¤‰æ•°å®£è¨€ã‚’è¡¨ã™Nodeã§ã™ã€‚
ä¸Šè¨˜ä¾‹ã§ã¯ã€FunctionDeclarationã‚„VariableDeclarationã¨VariableDeclaratorãŒè©²å½“ã—ã¾ã™ã€‚
è¦‹ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã‚ã‹ã‚‹é€šã‚Šã€
FunctionDeclarationã§ã¯ã€é–¢æ•°ã®å®£è¨€ã‚’è¡¨ç¾ã—ã¦ã„ã¾ã™ã­ã€‚
VariableDeclarationã¯kindã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«constç­‰ã®keywordã‚’æƒ…å ±ã‚’ä¿æŒã—ã¦ãŠã‚Šã€
VariableDeclaratorã§ã¯ã€å¤‰æ•°åã‚’è¡¨ã™Identifierã¨åˆæœŸå€¤ã‚’è¡¨ã™Literalã‚’ãã‚Œãã‚Œidã¨initã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä¿æŒã—ã¦ã„ã¾ã™ã€‚

### Identifier
å¤‰æ•°åã‚„é–¢æ•°åç­‰ã‚’è¡¨ã™Nodeã§ã™ã€‚
ä¸Šè¿°ã—ãŸã‚ˆã†ã«ã€VariableDeclaratorã‚„FunctionDeclarationç­‰ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

### Literal
æ–‡å­—åˆ—ã‚„æ•°å€¤ç­‰ã®ãƒªãƒ†ãƒ©ãƒ«ã‚’è¡¨ã™Nodeã§ã™ã€‚
ã“ã¡ã‚‰ã‚‚ä¸Šè¿°ã—ãŸã‚ˆã†ã«ã€VariableDeclaratorã‚„FunctionDeclarationç­‰ã§åˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚



ã‚‚ã—ASTã‚’ä»–ã«ã‚‚è‰²ã€…è©¦ã—ã¦ã¿ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆãŒä¾¿åˆ©ã§ã™ã€‚
JavaScriptã®ASTã¯Acornç³»ã®ã‚‚ã®ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

https://astexplorer.net/


ã¨ã“ã“ã¾ã§ã€ESTreeãƒ™ãƒ¼ã‚¹ã§è©±ã‚’é€²ã‚ã¦ãã¾ã—ãŸãŒä¸Šè¿°ã—ãŸé€šã‚ŠSWCã§ã¯ç‹¬è‡ªã®ASTã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
ã¨ã¯ã„ã£ã¦ã‚‚ã€ESTreeã¨å¤§ããå¤‰ã‚ã‚‹ã‚ã‘ã§ã¯ãªãä¼¼ãŸæ§‹é€ ã‚’ã—ã¦ã„ã‚‹ã®ã§ã“ã‚Œã‚‰ã®çŸ¥è­˜ã‚’åˆ©ç”¨ã—ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½œæˆã‚’é€²ã‚ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚


## SWCã®ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¦ã¿ã‚‹

## ã¾ã¨ã‚

## å‚è€ƒæ–‡çŒ®

https://oxc-project.github.io/javascript-parser-in-rust/docs/intro
https://astexplorer.net/
https://swc.rs/docs/plugin/ecmascript/getting-started
https://rustdoc.swc.rs/swc_ecma_visit/trait.VisitMut.html
https://www.wantedly.com/companies/wantedly/post_articles/389049

